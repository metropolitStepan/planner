# Инструкция по работе с Excel-файлом для планировщика расписания

## Создание примера файла

### Способ 1: Автоматическое создание (рекомендуется)

Для создания примера файла выполните:

```bash
# Установите зависимости (если еще не установлены)
pip install pandas openpyxl

# Создайте файл
python3 create_example_file.py
```

Это создаст файл `example_schedule.xlsx` с примером данных.

### Способ 2: Ручное создание в Excel

Если у вас нет Python или pandas, создайте файл вручную:

1. Откройте Excel (или LibreOffice Calc, Google Sheets)
2. Создайте новый файл и сохраните его как `example_schedule.xlsx`
3. Создайте 4 листа с точными названиями (см. ниже)
4. Заполните данные согласно примерам ниже

## Структура файла

Excel-файл должен содержать **4 обязательных листа** с точными названиями:

### 1. Лист "Упражнения"

Содержит информацию о типах упражнений.

**Колонки:**
- `Название` (обязательно) - название упражнения (уникальное)
- `Длительность` (обязательно) - длительность выполнения упражнения одним участником в **минутах** (целое число)

**Пример:**
| Название | Длительность |
|----------|--------------|
| Индивидуальная | 15 |
| Командная | 30 |
| Парная | 20 |

**Важно:** Названия упражнений должны быть уникальными и точно совпадать с названиями в листе "Группы".

---

### 2. Лист "Этапы"

Содержит информацию о максимальном количестве участников на каждом этапе.

**Колонки:**
- `МаксимумУчастников` (обязательно) - максимальное количество участников на этапе (целое число)

**Пример:**
| МаксимумУчастников |
|-------------------|
| 5 |
| 10 |
| 15 |
| 20 |

**Важно:** Этапы определяют, как группа участников будет разделяться на этапы. Например, если в группе 20 человек, а этапы: 5, 10, 15, то группа будет разделена на этапы по 5, 10 и 5 человек.

---

### 3. Лист "Корты"

Содержит информацию о площадках и их расписании работы.

**Колонки:**
- `Корт` (обязательно) - название/идентификатор площадки
- `Открытие` (обязательно) - время начала работы площадки (формат: `HH:MM:SS` или `HH:MM`)
- `Закрытие` (обязательно) - время окончания работы площадки (формат: `HH:MM:SS` или `HH:MM`)

**Пример:**
| Корт | Открытие | Закрытие |
|------|----------|----------|
| Зал 1 | 09:00:00 | 13:00:00 |
| Зал 1 | 14:00:00 | 18:00:00 |
| Зал 2 | 09:00:00 | 18:00:00 |
| Зал 3 | 10:00:00 | 17:00:00 |

**Важно:** 
- Одна площадка может иметь несколько строк, если в её работе есть перерывы (как "Зал 1" в примере)
- Время должно быть в формате времени Excel или текстовом формате `HH:MM:SS` или `HH:MM`
- Система автоматически определит минимальное время открытия и максимальное время закрытия всех кортов

---

### 4. Лист "Группы"

Содержит информацию о группах участников, которые нужно разместить в расписании.

**Колонки:**
- `ИмяГруппы` (обязательно) - название/идентификатор группы
- `КоличествоУчастников` (обязательно) - количество участников в группе (целое число, больше 0)
- `Упражнение` (обязательно) - название упражнения (должно **точно совпадать** с названием из листа "Упражнения")
- `МинимальноеВремяНачала` (опционально) - наиболее раннее время для размещения группы
  - Можно указать в минутах от начала дня (например, 540 = 09:00, 600 = 10:00)
  - Или в формате времени (например, "09:00:00" или "09:00")
- `МаксимальноеВремяОкончания` (опционально) - время, к которому группа должна завершить все этапы
  - Можно указать в минутах от начала дня (например, 1080 = 18:00, 1200 = 20:00)
  - Или в формате времени (например, "18:00:00" или "18:00")

**Пример:**
| ИмяГруппы | КоличествоУчастников | Упражнение | МинимальноеВремяНачала | МаксимальноеВремяОкончания |
|-----------|---------------------|------------|------------------------|---------------------------|
| Группа А | 10 | Индивидуальная | 540 | 1080 |
| Группа Б | 15 | Командная | | 1200 |
| Группа В | 8 | Индивидуальная | 600 | |
| Группа Г | 12 | Парная | | 1020 |

**Важно:**
- Если `МинимальноеВремяНачала` не указано, система использует минимальное время открытия всех кортов
- Если `МаксимальноеВремяОкончания` не указано, система использует максимальное время закрытия всех кортов
- Название упражнения должно **точно совпадать** (с учетом регистра) с названием из листа "Упражнения"

---

## Пример данных для ручного создания файла

### Лист "Упражнения"

Скопируйте эту таблицу в первый лист Excel и назовите лист "Упражнения":

| Название | Длительность |
|----------|--------------|
| Индивидуальная | 15 |
| Командная | 30 |
| Парная | 20 |

### Лист "Этапы"

Создайте второй лист, назовите его "Этапы":

| МаксимумУчастников |
|-------------------|
| 5 |
| 10 |
| 15 |
| 20 |

### Лист "Корты"

Создайте третий лист, назовите его "Корты":

| Корт | Открытие | Закрытие |
|------|----------|----------|
| Зал 1 | 09:00:00 | 13:00:00 |
| Зал 1 | 14:00:00 | 18:00:00 |
| Зал 2 | 09:00:00 | 18:00:00 |
| Зал 3 | 10:00:00 | 17:00:00 |

**Важно:** Время можно указать в формате `09:00:00` или просто `09:00`. Excel автоматически распознает формат времени.

### Лист "Группы"

Создайте четвертый лист, назовите его "Группы":

| ИмяГруппы | КоличествоУчастников | Упражнение | МинимальноеВремяНачала | МаксимальноеВремяОкончания |
|-----------|---------------------|------------|------------------------|---------------------------|
| Группа А | 10 | Индивидуальная | 540 | 1080 |
| Группа Б | 15 | Командная | | 1200 |
| Группа В | 8 | Индивидуальная | 600 | |
| Группа Г | 12 | Парная | | 1020 |

**Важно:** 
- Время можно указать в минутах (540 = 09:00) или в формате времени (09:00:00)
- Пустые ячейки означают, что ограничение не задано
- Название упражнения должно точно совпадать с названием из листа "Упражнения"

---

## Пошаговая инструкция по работе

### Шаг 1: Подготовка файла

1. Откройте Excel или другой редактор таблиц
2. Создайте новый файл или используйте пример `example_schedule.xlsx`
3. Убедитесь, что все 4 листа имеют **точные названия** (с учетом регистра):
   - `Упражнения`
   - `Этапы`
   - `Корты`
   - `Группы`

### Шаг 2: Заполнение данных

1. **Лист "Упражнения":**
   - Добавьте все типы упражнений, которые будут использоваться
   - Укажите длительность каждого упражнения в минутах

2. **Лист "Этапы":**
   - Укажите максимальное количество участников на каждом этапе
   - Этапы определяют, как группы будут разделяться

3. **Лист "Корты":**
   - Добавьте все площадки
   - Укажите время работы каждой площадки
   - Если площадка работает с перерывами, добавьте несколько строк с одним названием корта

4. **Лист "Группы":**
   - Добавьте все группы участников
   - Убедитесь, что название упражнения точно совпадает с названием из листа "Упражнения"
   - При необходимости укажите временные ограничения

### Шаг 3: Проверка данных

Перед загрузкой проверьте:

- ✅ Все листы имеют правильные названия
- ✅ Все обязательные колонки заполнены
- ✅ Названия упражнений в "Группы" совпадают с названиями в "Упражнения"
- ✅ Время указано в правильном формате
- ✅ Количество участников - положительные числа
- ✅ Длительность упражнений - положительные числа

### Шаг 4: Загрузка файла

1. Запустите API-сервер и фронтенд (см. README.md)
2. Откройте веб-интерфейс
3. Перейдите на вкладку "Загрузка данных"
4. Выберите ваш Excel-файл (`.xlsx` или `.csv`)
5. Нажмите "Загрузить"

### Шаг 5: Настройка параметров

1. Перейдите на вкладку "Параметры"
2. Укажите:
   - **Дату** соревновательного дня (формат: YYYY-MM-DD)
   - **Время начала** соревнований (формат: HH:MM)
   - **Время окончания** соревнований (формат: HH:MM)
   - **Длительность слота** в минутах (от 5 до 180)
   - **Количество параллельных потоков** (от 1)

### Шаг 6: Формирование расписания

1. Нажмите кнопку "Сформировать расписание"
2. Дождитесь обработки
3. Перейдите на вкладку "Расписание" для просмотра результата

---

## Частые ошибки и их решение

### Ошибка: "Не удалось построить расписание"

**Возможные причины:**
- Недостаточно времени для размещения всех групп
- Конфликты в расписании кортов
- Группы не помещаются в указанное временное окно

**Решение:**
- Увеличьте временное окно
- Добавьте больше кортов или увеличьте время их работы
- Уменьшите количество участников в группах
- Проверьте временные ограничения групп

### Ошибка: "unknown activity"

**Причина:** Название упражнения в листе "Группы" не совпадает с названием в листе "Упражнения"

**Решение:** Проверьте точное совпадение названий (с учетом регистра и пробелов)

### Ошибка: "planner.py did not return JSON"

**Причина:** Ошибка при чтении Excel-файла

**Решение:**
- Проверьте формат файла (должен быть `.xlsx`)
- Убедитесь, что все листы имеют правильные названия
- Проверьте, что все обязательные колонки присутствуют
- Убедитесь, что данные в правильном формате

---

## Примеры использования

### Пример 1: Простое расписание

**Упражнения:**
- Индивидуальная (15 мин)

**Этапы:**
- 5, 10, 15 участников

**Корты:**
- Зал 1: 09:00-18:00

**Группы:**
- Группа А: 10 участников, Индивидуальная

### Пример 2: Сложное расписание с перерывами

**Упражнения:**
- Индивидуальная (15 мин)
- Командная (30 мин)

**Этапы:**
- 5, 10, 15, 20 участников

**Корты:**
- Зал 1: 09:00-13:00, 14:00-18:00 (перерыв на обед)
- Зал 2: 09:00-18:00

**Группы:**
- Группа А: 20 участников, Индивидуальная, начало не раньше 10:00
- Группа Б: 15 участников, Командная, окончание не позже 17:00

---

## Дополнительные советы

1. **Используйте понятные названия** для групп и кортов - они будут отображаться в расписании
2. **Проверяйте временные ограничения** - слишком строгие ограничения могут сделать расписание невозможным
3. **Начинайте с простого** - сначала создайте небольшой файл с несколькими группами для проверки
4. **Сохраняйте копии** - перед изменением файла сохраните рабочую версию
5. **Используйте пример** - файл `example_schedule.xlsx` можно использовать как шаблон

---

## Формулы для расчета времени в минутах

Если нужно указать время в минутах от начала дня:

- 09:00 = 9 × 60 = 540 минут
- 10:00 = 10 × 60 = 600 минут
- 12:30 = 12 × 60 + 30 = 750 минут
- 18:00 = 18 × 60 = 1080 минут
- 20:00 = 20 × 60 = 1200 минут

Или просто используйте формат времени Excel: `09:00:00` или `09:00`

