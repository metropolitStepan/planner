# Решение ошибки 400: "Request failed with status code 400"

## Что означает ошибка 400?

Ошибка 400 (Bad Request) означает, что планировщик не смог построить расписание с заданными параметрами.

## Возможные причины и решения

### 1. Файл не был загружен

**Симптом:** Ошибка сразу после нажатия "Сформировать расписание"

**Решение:**
1. Перейдите на вкладку **"Загрузка данных"**
2. Загрузите файл `example_schedule.xlsx` (или другой Excel-файл)
3. Дождитесь сообщения "Загружено: ..."
4. Затем перейдите на вкладку **"Параметры"** и попробуйте снова

---

### 2. Недостаточно времени для размещения всех групп

**Симптом:** Ошибка после попытки построить расписание

**Причина:** Временное окно (09:00-20:00) недостаточно для размещения всех групп с учетом их размеров и длительности упражнений.

**Решение:**
- ✅ Увеличьте временное окно (например, 08:00-21:00)
- ✅ Уменьшите количество участников в группах
- ✅ Добавьте больше кортов в Excel-файл
- ✅ Увеличьте время работы кортов

---

### 3. Конфликты в расписании кортов

**Симптом:** Ошибка при наличии нескольких кортов с перерывами

**Причина:** Корты не могут вместить все группы в доступное время.

**Решение:**
- ✅ Убедитесь, что корты работают достаточно долго
- ✅ Добавьте больше кортов
- ✅ Убедитесь, что временные окна кортов перекрываются с временным окном соревнований

---

### 4. Слишком строгие временные ограничения групп

**Симптом:** Ошибка при наличии групп с ограничениями по времени

**Причина:** Временные ограничения групп (`МинимальноеВремяНачала`, `МаксимальноеВремяОкончания`) делают расписание невозможным.

**Решение:**
- ✅ Ослабьте временные ограничения в Excel-файле
- ✅ Удалите или увеличьте `МаксимальноеВремяОкончания`
- ✅ Уменьшите `МинимальноеВремяНачала`

---

### 5. Неправильный формат данных в Excel-файле

**Симптом:** Ошибка сразу после загрузки файла

**Причина:** Неправильная структура файла или неверные данные.

**Решение:**
- ✅ Проверьте, что все 4 листа имеют правильные названия: `Упражнения`, `Этапы`, `Корты`, `Группы`
- ✅ Убедитесь, что все обязательные колонки заполнены
- ✅ Проверьте, что названия упражнений в "Группы" точно совпадают с названиями в "Упражнения"
- ✅ Убедитесь, что время указано в правильном формате

---

## Пошаговая диагностика

### Шаг 1: Проверьте загрузку файла

1. Откройте вкладку "Загрузка данных"
2. Убедитесь, что файл загружен (должно быть сообщение "Загружено: ...")
3. Если файл не загружен, загрузите его снова

### Шаг 2: Проверьте параметры

Убедитесь, что:
- ✅ Временное окно достаточно большое (минимум 4-5 часов)
- ✅ Длительность слота разумная (10-30 минут)
- ✅ Параллельных потоков не слишком много (1-3)

### Шаг 3: Упростите данные

Попробуйте создать простой тестовый файл:
- 1 упражнение (15 минут)
- 1 корт (09:00-18:00)
- 1 группа (5-10 участников)
- Без временных ограничений

Если это работает, постепенно добавляйте сложность.

### Шаг 4: Проверьте логи сервера

Если ошибка повторяется, проверьте логи сервера (в терминале, где запущен `uvicorn`). Там может быть более детальная информация об ошибке.

---

## Рекомендуемые параметры для начала

Для тестирования используйте:

- **Время начала:** 09:00
- **Время окончания:** 18:00 (9 часов)
- **Длительность слота:** 15 минут
- **Параллельных потоков:** 2

И простой файл:
- 1-2 упражнения
- 1-2 корта (без перерывов)
- 2-3 группы (по 5-10 участников)

---

## Если ничего не помогает

1. Проверьте, что файл `example_schedule.xlsx` создан правильно (используйте скрипт `create_example_file.py`)
2. Убедитесь, что все зависимости установлены (`pandas`, `openpyxl`)
3. Попробуйте перезапустить API-сервер
4. Проверьте, что файл не поврежден (откройте его в Excel)

---

## Контакты для помощи

Если проблема не решается, проверьте:
- Логи сервера (терминал с `uvicorn`)
- Консоль браузера (F12 → Console)
- Структуру Excel-файла (должны быть все 4 листа с правильными названиями)

